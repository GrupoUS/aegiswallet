/*
 * Chat Widget Mobile & Desktop Fixes
 * Resolves viewport, scrolling, and responsive issues
 */

/* Root variables for consistent height management */
:root {
	--chat-widget-height: min(600px, 80dvh);
	--chat-widget-width: min(400px, 90vw);
	--chat-fullscreen-offset: 4rem;
	--chat-header-height: 3.5rem;
}

@media (max-width: 640px) {
	:root {
		--chat-widget-height: 85dvh;
		--chat-widget-width: 95vw;
		--chat-fullscreen-offset: 3rem;
	}
}

/* Root container fixes */
.chat-widget-container {
	height: 100vh;
	height: 100dvh; /* Dynamic viewport height for mobile browsers */
	max-height: -webkit-fill-available; /* Safari iOS fix */
	overflow: hidden;
	contain: strict; /* Performance optimization */
}

/* Widget specific fixes */
.chat-widget-window {
	/* position: fixed REMOVED - handled by parent container */
	contain: layout style paint;
	/* z-index controlled by parent */
}

/* Mobile viewport fixes */
@media (max-width: 640px) {
	.chat-widget-container {
		height: 90vh;
		height: 90dvh;
	}

	.chat-widget-window {
		/* Dimensions handled by inline styles/Tailwind classes using var() */
		max-height: -webkit-fill-available;
	}
}

/* Safe area insets for iOS devices */
@supports (padding: max(0px)) {
	.chat-widget-window {
		padding-bottom: max(env(safe-area-inset-bottom), 0px);
	}

	.chat-conversation-scroll {
		padding-bottom: max(env(safe-area-inset-bottom), 20px);
	}
}

/* Scroll behavior improvements */
.chat-conversation-scroll {
	/* StickToBottom manages scroll behavior internally */
	overscroll-behavior: contain;
	-webkit-overflow-scrolling: touch; /* iOS momentum scrolling */
	scrollbar-gutter: stable; /* Reserves space for scrollbar */
}

/* Viewport specific padding for StickToBottom */
.chat-conversation-scroll [data-stick-to-bottom-viewport] {
	scroll-padding-top: 1rem;
	scroll-padding-bottom: 1rem;
}

/* Scrollbar styling - Always visible and usable */
.chat-conversation-scroll::-webkit-scrollbar {
	width: 8px;
	height: 8px;
}

.chat-conversation-scroll::-webkit-scrollbar-track {
	background: hsl(var(--muted) / 0.3);
	border-radius: 4px;
}

.chat-conversation-scroll::-webkit-scrollbar-thumb {
	background-color: hsl(var(--muted-foreground) / 0.3);
	border-radius: 4px;
	border: 2px solid transparent;
	background-clip: content-box;
}

.chat-conversation-scroll::-webkit-scrollbar-thumb:hover {
	background-color: hsl(var(--muted-foreground) / 0.5);
}

/* Firefox scrollbar */
.chat-conversation-scroll {
	scrollbar-width: thin;
	scrollbar-color: hsl(var(--muted-foreground) / 0.3) hsl(var(--muted) / 0.3);
}

/* Keyboard navigation focus improvements */
.chat-widget-window *:focus {
	outline: 2px solid hsl(var(--primary));
	outline-offset: 2px;
}

/* Fullscreen mode fixes */
.chat-fullscreen-container {
	/* Consolidated height using custom properties */
	height: calc(100dvh - var(--chat-fullscreen-offset));
	max-height: -webkit-fill-available;
}

/* Loading states */
.chat-loading-indicator {
	animation: pulse 1.5s ease-in-out infinite;
}

@keyframes pulse {
	0%,
	100% {
		opacity: 1;
	}
	50% {
		opacity: 0.5;
	}
}

/* Accessibility improvements */
@media (prefers-reduced-motion: reduce) {
	.chat-conversation-scroll {
		scroll-behavior: auto;
	}

	.chat-loading-indicator {
		animation: none;
	}
}

/* Print styles */
@media print {
	.chat-widget-window {
		display: none;
	}
}
